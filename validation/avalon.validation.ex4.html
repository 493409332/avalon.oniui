<!DOCTYPE html>
<html>
    <head>
        <title>验证框架</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script src="../avalon.js">

        </script>
        <script src="../highlight/shCore.js">

        </script>
        <style >
            .error{
                border:1px  solid red;

            }
            .success{
                border:1px  solid greenyellow;
            }
            .error-tip{
                color: red;
                background:pink;
            }
        </style>
        <script>
            require(["validation/avalon.validation", "ready!"], function() {
                var validationVM

                function showError(el, data) {
                    var next = el.nextSibling
                    if (!(next && next.className === "error-tip")) {
                        next = document.createElement("div")
                        next.className = "error-tip"
                        el.parentNode.appendChild(next)
                    }
                    next.innerHTML = data.getMessage()
                }
                function removeError(el) {
                    var next = el.nextSibling
                    if (next && next.className === "error-tip") {
                        el.parentNode.removeChild(next)
                    }
                }
                avalon.define({
                    $id: "test",
                    $skipArray: ["validation"],
                    a: ["bbb"],
                    b: ["4","5"],
                    c: "d",
                    d: "",
                    e: "",
                    f: "",
                    g: "",
                    reset: function() {
                        validationVM && validationVM.resetAll()
                    },
                    checkAll: function(){
                         validationVM && validationVM.validateAll()
                    },
                    validation: {
                        validationHooks: {
                            contains: {
                                message: "必须是{{array}}中的一个",
                                get: function(val, data, next) {
                                   
                                    var array = data.element.getAttribute("data-duplex-contains") ||""
                                    array = array.split(",")
                                    //console.log(val)
                                    data.data.array = array
                                    next(array.indexOf(val) >= 0)
                                    return val
                                }
                            }
                        },
                        onInit: function(v) {
                            validationVM = v
                        },
                        onValidateAll: function(reasons) {
                            var msg = []
                            reasons.forEach(function(reason) {
                                msg.push(reason.getMessage())
                            })
                            if (reasons.length === 0) {
                                alert("全部验证成功！")
                            }else{
                                alert(msg.join("\n"))
                            }
                        }
                    }
                })
                avalon.scan()
            })
        </script>
    </head>
    <body>
        <form ms-controller="test" ms-widget="validation">
            <pre>select, checkbox, radiobox, textarea</pre>
            <select ms-duplex-contains="a" data-duplex-contains="aaa">
                <option value="aaa" >aaa</option>
                <option value="bbb" >bbb</option>
            </select> 必须选择 aaa
            <br />
            <label><input name="chk" type="checkbox" value="1" ms-duplex-contains="b" data-duplex-contains="1,2" />1</label>
            <label><input name="chk" type="checkbox" value="2"/>2</label>
            <label><input name="chk" type="checkbox" value="3" />3</label>
            <label><input name="chk" type="checkbox" value="4"/>4</label>
            <label><input name="chk" type="checkbox" value="5" />5</label>
            必须包含 1 或 2
            <br />
            <label><input name="rdo" type="radio" value="1" data-jvalidator-pattern="match[1]|match[2]" />1</label>
            <label><input name="rdo" type="radio" value="2" />2</label>
            <label><input name="rdo" type="radio" value="3" />3</label>
            <label><input name="rdo" type="radio" value="4" />4</label>
            <label><input name="rdo" type="radio" value="5" />5</label>
            必须选择 1 或 2
            <br />
            <textarea data-jvalidator-pattern="required"></textarea>
            必须有内容
            <br />
            <input type="button" value="验证" ms-click="checkAll" />
        </form>
    </body>
</html>
